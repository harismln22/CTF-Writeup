const mongoose = require('mongoose');
const crypto = require('crypto');
const User = require('./User'); // Import model User

// Hubungkan ke MongoDB
mongoose.connect('mongodb://localhost:27017/ctf1', {
  useNewUrlParser: true,
  useUnifiedTopology: true
}).then(() => {
  console.log('MongoDB connected');
}).catch(err => {
  console.error('MongoDB connection error:', err);
});

// Membuat dan menyimpan user baru
const password = crypto.randomBytes(16).toString("hex").slice(0, 16);
console.log("Generated password:", password);

const initialUser = new User({
  firstName: "pico",
  lastName: "player",
  email: "picoplayer355@picoctf.org",
  password: password
});

initialUser.save()
  .then(() => {
    console.log('User saved successfully');
    mongoose.connection.close(); // Tutup koneksi setelah selesai
  })
  .catch(err => {
    console.error('Error saving user:', err);
    mongoose.connection.close(); // Tutup koneksi meskipun ada error
  });
